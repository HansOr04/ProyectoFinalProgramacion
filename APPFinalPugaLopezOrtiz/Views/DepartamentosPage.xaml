<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:APPFinalPugaLopezOrtiz.ViewModels"
             xmlns:models="clr-namespace:APPFinalPugaLopezOrtiz.Services"
             x:Class="APPFinalPugaLopezOrtiz.Views.DepartamentosPage"
             x:DataType="viewmodels:DepartamentosViewModel"
             Title="{Binding Title}">

    <Grid RowDefinitions="Auto,*">
        <HorizontalStackLayout Grid.Row="0" 
                              Spacing="10" 
                              Padding="10"
                              HorizontalOptions="Center">

            <Button Text="Agregar Departamento" 
                    Command="{Binding NavigateToCreateCommand}"
                    IsVisible="{Binding IsAuthenticated}"
                    WidthRequest="200"/>

            <Button Text="Cerrar Sesión" 
                    Command="{Binding LogoutCommand}"
                    Style="{StaticResource SecondaryButtonStyle}"
                    WidthRequest="150"/>
        </HorizontalStackLayout>

        <RefreshView Grid.Row="1" 
                     Command="{Binding LoadDepartamentosCommand}"
                     IsRefreshing="{Binding IsBusy}">

            <CollectionView ItemsSource="{Binding Departamentos}"
                          SelectionMode="None">
                <CollectionView.EmptyView>
                    <StackLayout Padding="20">
                        <Label Text="No hay departamentos disponibles"
                               HorizontalOptions="Center"
                               FontSize="18"/>
                    </StackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:DepartamentoResponse">
                        <Frame Margin="10" 
                               Padding="10"
                               BorderColor="LightGray">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer 
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:DepartamentosViewModel}}, Path=NavigateToDetailCommand}"
                                    CommandParameter="{Binding .}"/>
                            </Frame.GestureRecognizers>

                            <Grid RowDefinitions="Auto,Auto,Auto" 
                                  ColumnDefinitions="*,Auto"
                                  RowSpacing="5">

                                <Image Grid.RowSpan="3" 
                                      Grid.Column="1"
                                      Source="{Binding ImagenUrl}"
                                      HeightRequest="100"
                                      WidthRequest="100"
                                      Aspect="AspectFill"/>

                                <Label Grid.Row="0" 
                                      Grid.Column="0"
                                      Text="{Binding Titulo}"
                                      FontSize="18"
                                      FontAttributes="Bold"/>

                                <Label Grid.Row="1" 
                                      Grid.Column="0"
                                      Text="{Binding Ciudad}"
                                      FontSize="16"/>

                                <HorizontalStackLayout Grid.Row="2" 
                                                     Grid.Column="0" 
                                                     Spacing="15">
                                    <Label Text="{Binding Habitaciones, StringFormat='Habitaciones: {0}'}"
                                           FontSize="14"/>
                                    <Label Text="{Binding Baños, StringFormat='Baños: {0}'}"
                                           FontSize="14"/>
                                </HorizontalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <ActivityIndicator Grid.RowSpan="2"
                          IsVisible="{Binding IsBusy}"
                          IsRunning="{Binding IsBusy}"
                          HorizontalOptions="Center"
                          VerticalOptions="Center"/>
    </Grid>

</ContentPage>